<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
var haveEvents="ongamepadconnected"in window,controllers={},used_axes=[1,5],motor_map={5:"a",1:"b"};function sleep(e){return new Promise(t=>setTimeout(t,e))}function connecthandler(e){addgamepad(e.gamepad)}function addgamepad(e){controllers[e.index]=e;var t=document.createElement("div");t.setAttribute("id","controller"+e.index);var a=document.createElement("h1");a.appendChild(document.createTextNode("gamepad: "+e.id)),t.appendChild(a);var n=document.createElement("div");for(var d in n.className="axes",used_axes){var o=document.createElement("progress"),r=used_axes[d];o.className="axis",o.setAttribute("max","2"),o.setAttribute("value","1"),o.innerHTML=r,n.appendChild(o)}t.appendChild(n);var s=document.getElementById("start");s&&(s.style.display="none"),document.body.appendChild(t),sleep(100).then(()=>{requestAnimationFrame(updateStatus)})}function disconnecthandler(e){removegamepad(e.gamepad)}function removegamepad(e){var t=document.getElementById("controller"+e.index);document.body.removeChild(t),delete controllers[e.index]}function updateStatus(){haveEvents||scangamepads();var e,t=0;for(e in controllers){var a=controllers[e],n=document.getElementById("controller"+e),d={},o=n.getElementsByClassName("axis");for(var t in a.axes)if(t in used_axes){var r=o[t];axis=used_axes[t];var s=a.axes[axis].toFixed(1);motor=motor_map[String(axis)],d[motor]=s,r.innerHTML=t+": "+a.axes[t].toFixed(4),r.setAttribute("value",a.axes[t]+1)}path="/",$.post({url:path,data:JSON.stringify(d),dataType:"json",success:function(){console.log(JSON.stringify(d))}})}var i=document.getElementById("tempbox");$.get("/temp",function(e){i.innerHTML="<p>CPU Temp: "+String(e)+"</p>"}),sleep(100).then(()=>{requestAnimationFrame(updateStatus)})}function scangamepads(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++)e[t]&&(e[t].index in controllers?controllers[e[t].index]=e[t]:addgamepad(e[t]))}window.addEventListener("gamepadconnected",connecthandler),window.addEventListener("gamepaddisconnected",disconnecthandler),haveEvents||setInterval(scangamepads,500);
</script>
</head><body style="width:960px; margin: 20px auto;">
<div id="tempbox"></div>
<!--<video src='rtsp://192.168.1.151:8554/stream'></video>--> 
</body></html>
